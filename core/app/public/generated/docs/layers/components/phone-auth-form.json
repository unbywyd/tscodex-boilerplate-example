{
  "path": "layers/components/phone-auth-form.toml",
  "name": "phone-auth-form.toml",
  "type": "toml",
  "content": {
    "component": {
      "id": "phone-auth-form",
      "name": "Phone Auth Form",
      "description": "Phone number authentication with SMS OTP verification",
      "props": {
        "app": "'client' | 'specialist' | 'admin'",
        "onSuccess": "(user: UserEntity) => void",
        "onSkip": "() => void (optional, client only)"
      },
      "features": {
        "list": [
          "Phone number input with Israeli format (05x-xxx-xxxx)",
          "Auto-formatting as user types (formatPhone function)",
          "Phone validation (10 digits, starts with 05)",
          "Send 6-digit OTP code via SMS (auth.otp_sent event)",
          "OTP input with 6 separate fields (OTPInput component)",
          "Auto-submit when all 6 digits entered (onComplete callback)",
          "OTP validation (exactly 6 digits)",
          "Resend code option (optional, not shown in current implementation)",
          "Skip auth for guest browsing (client only, onSkip prop)",
          "Multi-step flow: phone → OTP → profile → permissions (client only)",
          "Error messages display (validation errors)",
          "Toast notifications for user feedback"
        ]
      },
      "flow": {
        "description": "Multi-step authentication flow (varies by app type)",
        "steps": [
          {
            "step": 1,
            "name": "Phone Input",
            "description": "User enters phone number in format 05x-xxx-xxxx",
            "validation": "10 digits, starts with 05 (isValidPhone check)",
            "action": "Click 'Continue' button",
            "formatting": "Auto-format as user types: 05x-xxx-xxxx",
            "backend": "Generate 6-digit code, store with 5 min TTL, send via SMS provider",
            "event": "auth-otp-sent",
            "error": "Enter 10 digits (e.g. 050-123-4567)"
          },
          {
            "step": 2,
            "name": "OTP Verification",
            "description": "User enters 6-digit code from SMS",
            "validation": "Exactly 6 digits (isValidOtp check)",
            "action": "Auto-verify on 6th digit (OTPInput onComplete) or click 'Continue'",
            "formatting": "Auto-format: digits only, max 6 characters",
            "backend": "Validate code, create session, return auth token",
            "event": "auth-verified",
            "error": "Enter 6-digit code",
            "next_step": "profile (client) or success (specialist/admin)"
          },
          {
            "step": 3,
            "name": "Profile Setup (Client Only)",
            "description": "User enters name, city, and address",
            "fields": [
              "name (required)",
              "city (MobilePicker with ISRAELI_CITIES)",
              "address (optional)"
            ],
            "validation": "Name is required",
            "action": "Click 'Continue' button",
            "next_step": "permissions"
          },
          {
            "step": 4,
            "name": "Permissions (Client Only)",
            "description": "Request notifications and location permissions",
            "fields": [
              "notifications (Switch)",
              "location (Switch)"
            ],
            "action": "Click 'Get Started' button",
            "backend": "Save preferences, complete login, create user profile",
            "event": "auth-login-success"
          }
        ]
      },
      "backend": {
        "sms_provider": "Twilio / MessageBird (configurable)",
        "otp_length": 6,
        "otp_ttl": "5 minutes",
        "rate_limit": "3 attempts per phone per 15 minutes",
        "session_duration": "30 days"
      },
      "styling": {
        "layout": "Screen layout with ScreenHeader, ScreenBody, ScreenFooter",
        "phone_input": "Input with Phone icon, full-width, auto-format on change",
        "otp_input": "OTPInput component with 6 separate fields, auto-focus next, auto-submit on complete",
        "profile_form": "Card layout with name Input, city MobilePicker, address Input",
        "permissions": "Card layout with Switch components for notifications and location",
        "buttons": "Full width Button, primary color (cyan for client, amber for specialist, violet for admin)",
        "error_display": "Error text below inputs, Toast notifications",
        "skip_button": "Ghost variant Button, shown only on first step (client only)"
      }
    },
    "relations": {
      "routes": [
        "client-login",
        "specialist-login",
        "admin-login"
      ],
      "events": [
        "auth-otp-sent",
        "auth-verified"
      ],
      "useCases": [
        "authenticate-phone"
      ],
      "entities": [
        "user"
      ]
    },
    "implementation": {
      "status": "implemented",
      "note": "Implemented as LoginScreen component with multi-step flow",
      "files": {
        "client": "src/prototype/pages/client/LoginScreen.tsx - Full flow: phone → OTP → profile → permissions",
        "specialist": "src/prototype/pages/specialist/LoginScreen.tsx - Two-step: phone → OTP",
        "admin": "src/prototype/pages/admin/LoginScreen.tsx - Two-step: phone → OTP"
      },
      "details": {
        "phone_formatting": "formatPhone function: auto-formats to 05x-xxx-xxxx as user types",
        "otp_formatting": "formatOtp function: digits only, max 6 characters",
        "validation": "isValidPhone (10 digits) and isValidOtp (6 digits) checks",
        "error_handling": "Error state + Toast notifications for validation failures",
        "events": "dispatchEvent for auth.otp_sent and auth.verified",
        "user_creation": "login() hook creates user with phone, name, city, address, permissions"
      }
    }
  },
  "rawContent": "[component]\nid = \"phone-auth-form\"\nname = \"Phone Auth Form\"\ndescription = \"Phone number authentication with SMS OTP verification\"\n\n[component.props]\napp = \"'client' | 'specialist' | 'admin'\"\nonSuccess = \"(user: UserEntity) => void\"\nonSkip = \"() => void (optional, client only)\"\n\n[component.features]\nlist = [\n  \"Phone number input with Israeli format (05x-xxx-xxxx)\",\n  \"Auto-formatting as user types (formatPhone function)\",\n  \"Phone validation (10 digits, starts with 05)\",\n  \"Send 6-digit OTP code via SMS (auth.otp_sent event)\",\n  \"OTP input with 6 separate fields (OTPInput component)\",\n  \"Auto-submit when all 6 digits entered (onComplete callback)\",\n  \"OTP validation (exactly 6 digits)\",\n  \"Resend code option (optional, not shown in current implementation)\",\n  \"Skip auth for guest browsing (client only, onSkip prop)\",\n  \"Multi-step flow: phone → OTP → profile → permissions (client only)\",\n  \"Error messages display (validation errors)\",\n  \"Toast notifications for user feedback\"\n]\n\n[component.flow]\ndescription = \"Multi-step authentication flow (varies by app type)\"\n\n[[component.flow.steps]]\nstep = 1\nname = \"Phone Input\"\ndescription = \"User enters phone number in format 05x-xxx-xxxx\"\nvalidation = \"10 digits, starts with 05 (isValidPhone check)\"\naction = \"Click 'Continue' button\"\nformatting = \"Auto-format as user types: 05x-xxx-xxxx\"\nbackend = \"Generate 6-digit code, store with 5 min TTL, send via SMS provider\"\nevent = \"auth-otp-sent\"\nerror = \"Enter 10 digits (e.g. 050-123-4567)\"\n\n[[component.flow.steps]]\nstep = 2\nname = \"OTP Verification\"\ndescription = \"User enters 6-digit code from SMS\"\nvalidation = \"Exactly 6 digits (isValidOtp check)\"\naction = \"Auto-verify on 6th digit (OTPInput onComplete) or click 'Continue'\"\nformatting = \"Auto-format: digits only, max 6 characters\"\nbackend = \"Validate code, create session, return auth token\"\nevent = \"auth-verified\"\nerror = \"Enter 6-digit code\"\nnext_step = \"profile (client) or success (specialist/admin)\"\n\n[[component.flow.steps]]\nstep = 3\nname = \"Profile Setup (Client Only)\"\ndescription = \"User enters name, city, and address\"\nfields = [\"name (required)\", \"city (MobilePicker with ISRAELI_CITIES)\", \"address (optional)\"]\nvalidation = \"Name is required\"\naction = \"Click 'Continue' button\"\nnext_step = \"permissions\"\n\n[[component.flow.steps]]\nstep = 4\nname = \"Permissions (Client Only)\"\ndescription = \"Request notifications and location permissions\"\nfields = [\"notifications (Switch)\", \"location (Switch)\"]\naction = \"Click 'Get Started' button\"\nbackend = \"Save preferences, complete login, create user profile\"\nevent = \"auth-login-success\"\n\n[component.backend]\nsms_provider = \"Twilio / MessageBird (configurable)\"\notp_length = 6\notp_ttl = \"5 minutes\"\nrate_limit = \"3 attempts per phone per 15 minutes\"\nsession_duration = \"30 days\"\n\n[component.styling]\nlayout = \"Screen layout with ScreenHeader, ScreenBody, ScreenFooter\"\nphone_input = \"Input with Phone icon, full-width, auto-format on change\"\notp_input = \"OTPInput component with 6 separate fields, auto-focus next, auto-submit on complete\"\nprofile_form = \"Card layout with name Input, city MobilePicker, address Input\"\npermissions = \"Card layout with Switch components for notifications and location\"\nbuttons = \"Full width Button, primary color (cyan for client, amber for specialist, violet for admin)\"\nerror_display = \"Error text below inputs, Toast notifications\"\nskip_button = \"Ghost variant Button, shown only on first step (client only)\"\n\n[relations]\nroutes = [\"client-login\", \"specialist-login\", \"admin-login\"]\nevents = [\"auth-otp-sent\", \"auth-verified\"]\nuseCases = [\"authenticate-phone\"]\nentities = [\"user\"]\n\n[implementation]\nstatus = \"implemented\"\nnote = \"Implemented as LoginScreen component with multi-step flow\"\n\n[implementation.files]\nclient = \"src/prototype/pages/client/LoginScreen.tsx - Full flow: phone → OTP → profile → permissions\"\nspecialist = \"src/prototype/pages/specialist/LoginScreen.tsx - Two-step: phone → OTP\"\nadmin = \"src/prototype/pages/admin/LoginScreen.tsx - Two-step: phone → OTP\"\n\n[implementation.details]\nphone_formatting = \"formatPhone function: auto-formats to 05x-xxx-xxxx as user types\"\notp_formatting = \"formatOtp function: digits only, max 6 characters\"\nvalidation = \"isValidPhone (10 digits) and isValidOtp (6 digits) checks\"\nerror_handling = \"Error state + Toast notifications for validation failures\"\nevents = \"dispatchEvent for auth.otp_sent and auth.verified\"\nuser_creation = \"login() hook creates user with phone, name, city, address, permissions\"\n",
  "metadata": {
    "size": 4529,
    "modified": "2025-12-15T08:33:37.299Z"
  }
}