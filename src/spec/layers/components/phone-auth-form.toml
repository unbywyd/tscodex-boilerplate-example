[component]
id = "phone-auth-form"
name = "Phone Auth Form"
description = "Phone number authentication with SMS OTP verification"

[component.props]
app = "'client' | 'specialist' | 'admin'"
onSuccess = "(user: UserEntity) => void"
onSkip = "() => void (optional, client only)"

[component.features]
list = [
  "Phone number input with Israeli format (05x-xxx-xxxx)",
  "Auto-formatting as user types (formatPhone function)",
  "Phone validation (10 digits, starts with 05)",
  "Send 6-digit OTP code via SMS (auth.otp_sent event)",
  "OTP input with 6 separate fields (OTPInput component)",
  "Auto-submit when all 6 digits entered (onComplete callback)",
  "OTP validation (exactly 6 digits)",
  "Resend code option (optional, not shown in current implementation)",
  "Skip auth for guest browsing (client only, onSkip prop)",
  "Multi-step flow: phone → OTP → profile → permissions (client only)",
  "Error messages display (validation errors)",
  "Toast notifications for user feedback"
]

[component.flow]
description = "Multi-step authentication flow (varies by app type)"

[[component.flow.steps]]
step = 1
name = "Phone Input"
description = "User enters phone number in format 05x-xxx-xxxx"
validation = "10 digits, starts with 05 (isValidPhone check)"
action = "Click 'Continue' button"
formatting = "Auto-format as user types: 05x-xxx-xxxx"
backend = "Generate 6-digit code, store with 5 min TTL, send via SMS provider"
event = "auth-otp-sent"
error = "Enter 10 digits (e.g. 050-123-4567)"

[[component.flow.steps]]
step = 2
name = "OTP Verification"
description = "User enters 6-digit code from SMS"
validation = "Exactly 6 digits (isValidOtp check)"
action = "Auto-verify on 6th digit (OTPInput onComplete) or click 'Continue'"
formatting = "Auto-format: digits only, max 6 characters"
backend = "Validate code, create session, return auth token"
event = "auth-verified"
error = "Enter 6-digit code"
next_step = "profile (client) or success (specialist/admin)"

[[component.flow.steps]]
step = 3
name = "Profile Setup (Client Only)"
description = "User enters name, city, and address"
fields = ["name (required)", "city (MobilePicker with ISRAELI_CITIES)", "address (optional)"]
validation = "Name is required"
action = "Click 'Continue' button"
next_step = "permissions"

[[component.flow.steps]]
step = 4
name = "Permissions (Client Only)"
description = "Request notifications and location permissions"
fields = ["notifications (Switch)", "location (Switch)"]
action = "Click 'Get Started' button"
backend = "Save preferences, complete login, create user profile"
event = "auth-login-success"

[component.backend]
sms_provider = "Twilio / MessageBird (configurable)"
otp_length = 6
otp_ttl = "5 minutes"
rate_limit = "3 attempts per phone per 15 minutes"
session_duration = "30 days"

[component.styling]
layout = "Screen layout with ScreenHeader, ScreenBody, ScreenFooter"
phone_input = "Input with Phone icon, full-width, auto-format on change"
otp_input = "OTPInput component with 6 separate fields, auto-focus next, auto-submit on complete"
profile_form = "Card layout with name Input, city MobilePicker, address Input"
permissions = "Card layout with Switch components for notifications and location"
buttons = "Full width Button, primary color (cyan for client, amber for specialist, violet for admin)"
error_display = "Error text below inputs, Toast notifications"
skip_button = "Ghost variant Button, shown only on first step (client only)"

[relations]
routes = ["client-login", "specialist-login", "admin-login"]
events = ["auth-otp-sent", "auth-verified"]
useCases = ["authenticate-phone"]
entities = ["user"]

[implementation]
status = "implemented"
note = "Implemented as LoginScreen component with multi-step flow"

[implementation.files]
client = "src/prototype/pages/client/LoginScreen.tsx - Full flow: phone → OTP → profile → permissions"
specialist = "src/prototype/pages/specialist/LoginScreen.tsx - Two-step: phone → OTP"
admin = "src/prototype/pages/admin/LoginScreen.tsx - Two-step: phone → OTP"

[implementation.details]
phone_formatting = "formatPhone function: auto-formats to 05x-xxx-xxxx as user types"
otp_formatting = "formatOtp function: digits only, max 6 characters"
validation = "isValidPhone (10 digits) and isValidOtp (6 digits) checks"
error_handling = "Error state + Toast notifications for validation failures"
events = "dispatchEvent for auth.otp_sent and auth.verified"
user_creation = "login() hook creates user with phone, name, city, address, permissions"
